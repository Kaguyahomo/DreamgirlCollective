<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Vocab Quiz</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Specific Styles for the Quiz Page */
        .leaderboard {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .leaderboard li {
            margin: 10px 0;
            color: white;
        }

        .middle {
            min-height: 400px;
        }

        /* Countdown Timer Styling */
        .countdown {
            text-align: center;
            padding: 1rem;
            background-color: #ffd1dc; /* Pastel pink */
            border-radius: 8px;
            margin-bottom: 20px;
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .container {
                display: flex;
                flex-direction: column;
                gap: 20px;
            }

            .left, .middle, .right {
                margin-bottom: 20px;
            }
        }
    </style>
    <script>
        let vocabWords = [];
        const usedWords = [];

        // Fetch Vocabulary Words from JSON
        async function fetchVocabulary() {
            try {
                const response = await fetch('vocab.json');
                const allWords = await response.json();

                // Randomly select 10 words and remove them from the JSON
                const selectedWords = allWords.sort(() => 0.5 - Math.random()).slice(0, 10);
                vocabWords = selectedWords;

                // Remove selected words from the JSON for the next week
                const remainingWords = allWords.filter(word => !selectedWords.includes(word));
                saveUpdatedJSON(remainingWords);

                loadContent();
            } catch (error) {
                console.error('Error fetching vocabulary words:', error);
            }
        }

        // Save updated JSON after removing used words
        async function saveUpdatedJSON(remainingWords) {
            try {
                await fetch('save-json.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(remainingWords)
                });
            } catch (error) {
                console.error('Error saving updated JSON:', error);
            }
        }

        // Load Vocabulary Words or Quiz
        function loadContent() {
            const now = new Date();
            const day = now.getDay();
            const hour = now.getHours();
            const contentDiv = document.getElementById('content');

            // Display Quiz for 1 Hour on Sunday Noon
            if (day === 0 && hour === 12) {
                showQuiz(contentDiv);
            } else {
                showWords(contentDiv);
            }
        }

        // Show Vocabulary Words
        function showWords(contentDiv) {
            contentDiv.innerHTML = '<h2>Study This Week\'s Words</h2>';
            vocabWords.forEach(({ word, definition }) => {
                const entry = document.createElement('p');
                entry.textContent = `${word} - ${definition}`;
                contentDiv.appendChild(entry);
            });
        }

        // Show Quiz
        function showQuiz(contentDiv) {
            contentDiv.innerHTML = `
                <h2>Weekly Quiz</h2>
                <label for="name">Enter Your Name:</label>
                <input type="text" id="name" placeholder="Your Name" required>
            `;

            vocabWords.forEach(({ word }) => {
                const quizEntry = document.createElement('div');
                quizEntry.innerHTML = `
                    <p>${word}</p>
                    <input type="text" placeholder="Enter your definition" required>
                `;
                contentDiv.appendChild(quizEntry);
            });

            const submitButton = document.createElement('button');
            submitButton.textContent = 'Submit Quiz';
            contentDiv.appendChild(submitButton);

            submitButton.addEventListener('click', handleSubmitQuiz);
        }

        // Handle Quiz Submission
        async function handleSubmitQuiz() {
            const name = document.getElementById('name').value;
            const answers = Array.from(document.querySelectorAll('.middle input[type="text"]')).map(input => input.value);

            // Grade the quiz
            let score = 0;
            answers.forEach((answer, index) => {
                if (answer.toLowerCase() === vocabWords[index].definition.toLowerCase()) {
                    score++;
                }
            });

            // Update leaderboard dynamically
            const leaderboardEntry = `${name} - ${score}/${vocabWords.length}`;
            const leaderboardList = document.getElementById('leaderboard');
            const listItem = document.createElement('li');
            listItem.textContent = leaderboardEntry;
            leaderboardList.appendChild(listItem);

            alert(`You scored ${score}/${vocabWords.length}`);
        }

        // Countdown Timer
        function updateCountdown() {
            const now = new Date();
            const nextSundayNoon = new Date();
            nextSundayNoon.setDate(now.getDate() + ((7 - now.getDay()) % 7));
            nextSundayNoon.setHours(12, 0, 0, 0);

            const timeDifference = nextSundayNoon - now;
            const days = Math.floor(timeDifference / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeDifference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeDifference % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeDifference % (1000 * 60)) / 1000);

            document.getElementById('countdown').textContent = `Next Quiz: ${days}d ${hours}h ${minutes}m ${seconds}s`;

            if (timeDifference > 0) {
                setTimeout(updateCountdown, 1000);
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            fetchVocabulary();
            document.getElementById('signup-form').addEventListener('submit', handleSignup);
            updateCountdown();
        });

        // Sign-Up Form
        async function handleSignup(event) {
            event.preventDefault();
            const phone = document.getElementById('phone').value;
            const carrierEmail = document.getElementById('carrier-email').value;

            const emailTo = `${phone}${carrierEmail}`;
            try {
                const response = await fetch('signup.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ emailTo }),
                });

                const result = await response.json();
                if (result.success) {
                    alert('You are successfully signed up!');
                } else {
                    alert('Sign-up failed.');
                }
            } catch (error) {
                console.error('Error during sign-up:', error);
            }
        }
    </script>
</head>
<body>
    <header>
        <h1>Weekly Vocab Quiz</h1>
    </header>
    <div class="countdown" id="countdown"></div>
    <div class="container">
        <!-- Left Column: Sign-up -->
        <div class="left">
            <h2>Sign Up</h2>
            <form id="signup-form">
                <label for="phone">Phone Number:</label>
                <input type="tel" id="phone" placeholder="Enter your phone number" required>
                <label for="carrier-email">Carrier Email:</label>
                <select id="carrier-email" required>
                    <option value="@vtext.com">Verizon</option>
                    <option value="@txt.att.net">AT&T</option>
                    <option value="@tmomail.net">T-Mobile</option>
                </select>
                <button type="submit">Sign Up</button>
            </form>
        </div>

        <!-- Middle Column: Vocab List or Quiz -->
        <div class="middle" id="content"></div>

        <!-- Right Column: Leaderboard -->
        <div class="right">
            <h2>Leaderboard</h2>
            <ul class="leaderboard" id="leaderboard"></ul>
        </div>
    </div>
    <footer>
        <p>&copy; 2024 Weekly Vocab Quiz. All rights reserved.</p>
    </footer>
</body>
</html>